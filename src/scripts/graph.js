// hardcoded data for now
// game # : total stat so far
let data = {
  stephenCurry: [
    { game: 0, total: 0 },
    { game: 1, total: 3 },
    { game: 2, total: 7 },
    { game: 3, total: 13 },
    { game: 4, total: 15 },
    { game: 5, total: 19 },
    { game: 6, total: 22 },
    { game: 7, total: 25 },
    { game: 8, total: 32 },
    { game: 9, total: 35 },
    { game: 10, total: 40 },
    { game: 11, total: 42 },
    { game: 12, total: 44 },
    { game: 13, total: 47 },
    { game: 14, total: 49 },
    { game: 15, total: 53 },
    { game: 16, total: 57 },
    { game: 17, total: 60 },
    { game: 18, total: 64 },
    { game: 19, total: 67 },
    { game: 20, total: 70 },
    { game: 21, total: 73 },
    { game: 22, total: 78 },
    { game: 23, total: 83 },
    { game: 24, total: 93 },
    { game: 25, total: 99 },
    { game: 26, total: 103 },
    { game: 27, total: 111 },
    { game: 28, total: 116 },
    { game: 29, total: 118 },
    { game: 30, total: 122 },
    { game: 31, total: 128 },
    { game: 32, total: 133 },
    { game: 33, total: 141 },
    { game: 34, total: 146 },
    { game: 35, total: 154 },
    { game: 36, total: 155 },
    { game: 37, total: 158 },
    { game: 38, total: 163 },
    { game: 39, total: 165 },
    { game: 40, total: 169 },
    { game: 41, total: 172 },
    { game: 42, total: 175 },
    { game: 43, total: 178 },
    { game: 44, total: 186 },
    { game: 45, total: 191 },
    { game: 46, total: 195 },
    { game: 47, total: 199 },
    { game: 48, total: 203 },
    { game: 49, total: 209 },
    { game: 50, total: 209 },
    { game: 51, total: 212 }
  ],
  joelEmbiid: [
    { game: 0, total: 0 },
    { game: 1, total: 0 },
    { game: 2, total: 0 },
    { game: 3, total: 1 },
    { game: 4, total: 2 },
    { game: 5, total: 5 },
    { game: 6, total: 5 },
    { game: 7, total: 6 },
    { game: 8, total: 6 },
    { game: 9, total: 7 },
    { game: 10, total: 7 },
    { game: 11, total: 8 },
    { game: 12, total: 10 },
    { game: 13, total: 11 },
    { game: 14, total: 11 },
    { game: 15, total: 12 },
    { game: 16, total: 13 },
    { game: 17, total: 13 },
    { game: 18, total: 13 },
    { game: 19, total: 13 },
    { game: 20, total: 13 },
    { game: 21, total: 15 },
    { game: 22, total: 15 },
    { game: 23, total: 16 },
    { game: 24, total: 16 },
    { game: 25, total: 17 },
    { game: 26, total: 19 },
    { game: 27, total: 25 },
    { game: 28, total: 25 },
    { game: 29, total: 25 },
    { game: 30, total: 25 },
    { game: 31, total: 26 },
    { game: 32, total: 27 },
    { game: 33, total: 28 },
    { game: 34, total: 28 },
    { game: 35, total: 30 },
    { game: 36, total: 30 },
    { game: 37, total: 31 },
    { game: 38, total: 32 },
    { game: 39, total: 35 },
    { game: 40, total: 36 },
    { game: 41, total: 36 },
    { game: 42, total: 36 },
    { game: 43, total: 39 },
    { game: 44, total: 41 },
    { game: 45, total: 42 },
    { game: 46, total: 43 },
    { game: 47, total: 43 },
    { game: 48, total: 46 },
    { game: 49, total: 47 },
    { game: 50, total: 49 },
    { game: 51, total: 52 },
    { game: 52, total: 52 },
    { game: 53, total: 53 },
    { game: 54, total: 53 },
    { game: 55, total: 53 },
    { game: 56, total: 56 },
    { game: 57, total: 57 },
    { game: 58, total: 57 },
    { game: 59, total: 59 },
    { game: 60, total: 60 },
    { game: 61, total: 64 },
    { game: 62, total: 64 },
    { game: 63, total: 65 },
    { game: 64, total: 66 },
    { game: 65, total: 66 },
    { game: 66, total: 66 },
    { game: 67, total: 69 },
    { game: 68, total: 69 },
    { game: 69, total: 69 },
    { game: 70, total: 71 },
    { game: 71, total: 72 },
    { game: 72, total: 72 },
    { game: 73, total: 74 },
    { game: 74, total: 74 }
  ],
  georgeHill: [
    { game: 0, total: 0 },
    { game: 1, total: 1 },
    { game: 2, total: 4 },
    { game: 3, total: 4 },
    { game: 4, total: 4 },
    { game: 5, total: 4 },
    { game: 6, total: 4 },
    { game: 7, total: 6 },
    { game: 8, total: 6 },
    { game: 9, total: 6 },
    { game: 10, total: 7 },
    { game: 11, total: 10 },
    { game: 12, total: 11 },
    { game: 13, total: 12 },
    { game: 14, total: 14 },
    { game: 15, total: 17 },
    { game: 16, total: 17 },
    { game: 17, total: 18 },
    { game: 18, total: 22 },
    { game: 19, total: 22 },
    { game: 20, total: 22 },
    { game: 21, total: 22 },
    { game: 22, total: 24 },
    { game: 23, total: 25 },
    { game: 24, total: 27 },
    { game: 25, total: 31 },
    { game: 26, total: 35 },
    { game: 27, total: 39 },
    { game: 28, total: 40 },
    { game: 29, total: 40 },
    { game: 30, total: 40 },
    { game: 31, total: 41 },
    { game: 32, total: 42 },
    { game: 33, total: 45 },
    { game: 34, total: 46 },
    { game: 35, total: 46 },
    { game: 36, total: 48 },
    { game: 37, total: 52 },
    { game: 38, total: 52 },
    { game: 39, total: 52 },
    { game: 40, total: 52 },
    { game: 41, total: 52 },
    { game: 42, total: 55 },
    { game: 43, total: 56 },
    { game: 44, total: 56 },
    { game: 45, total: 56 },
    { game: 46, total: 58 },
    { game: 47, total: 60 },
    { game: 48, total: 61 },
    { game: 49, total: 61 },
    { game: 50, total: 62 },
    { game: 51, total: 62 },
    { game: 52, total: 65 },
    { game: 53, total: 65 },
    { game: 54, total: 68 },
    { game: 55, total: 68 },
    { game: 56, total: 69 },
    { game: 57, total: 71 },
    { game: 58, total: 72 },
    { game: 59, total: 74 },
    { game: 60, total: 76 },
    { game: 61, total: 77 },
    { game: 62, total: 77 },
    { game: 63, total: 79 },
    { game: 64, total: 80 },
    { game: 65, total: 83 },
    { game: 66, total: 83 },
    { game: 67, total: 84 },
    { game: 68, total: 84 },
    { game: 69, total: 85 },
    { game: 70, total: 85 }
  ]
};

function resizingFunction(svg) {
  let width = parseInt(svg.style('width'), 10);
  let height = parseInt(svg.style('height'), 10);
  let aspectRatio = width / height;

  svg.attr('viewBox', `0 0 ${width} ${height}`)
    .attr('preserveAspectRatio', 'xMinYMin')
    .call(resize);

  d3.select(window).on('resize', resize);

  function resize() {
    let docGraphWidth = document.getElementById("graph-container").clientWidth;

    svg.attr('width', docGraphWidth);
    svg.attr('height', Math.round(docGraphWidth / aspectRatio));
  }
}

function makeGraph() {
  let margin = { top: 50, right: 50, bottom: 50, left: 50 };
  let docGraphWidth = document.getElementById("graph-container").clientWidth;
  let docGraphHeight = document.getElementById("graph-container").clientHeight;

  let width = docGraphWidth - margin.left - margin.right;
  let height = docGraphHeight - margin.top - margin.bottom;

  // Margin convention and make the graph resize as the window resizes
  // From now on, all subsequent code can just use 'width' and 'height'
  let svg = d3.select('#graph-container').append("svg")
      .attr('width', docGraphWidth)
      .attr('height', docGraphHeight)
      .call(resizingFunction);

  let g = svg.append("g")
      .attr("transform", "translate(" + margin.left + "," + margin.top + ")");

  let maxTotal = Math.max(...Object.values(data).map(player => {
    return player[player.length-1].total;
  }));

  let xScale = d3.scaleLinear()
    .domain([0, 82])
    .range([0, width]);

  let yScale = d3.scaleLinear()
    .domain([0, maxTotal+20])
    .range([height, 0]);

  let line = d3.line()
    .x(function (d) { return xScale(d.game); })
    .y(function (d) { return yScale(d.total); })
    .curve(d3.curveLinear);

  let linesContainer = g.append('g')
    .attr('class', 'lines-container');

  let color = d3.scaleOrdinal(d3.schemeCategory10);

  // change these two to g.append if want axis in front of the lines
  linesContainer.append("g")
    .attr("transform", "translate(0," + height + ")")
    .call(d3.axisBottom(xScale));

  linesContainer.append("g")
    .call(d3.axisLeft(yScale))
    .append("text")
    .attr("fill", "#000")
    .attr("transform", "rotate(-90)")
    .attr("y", 10)
    .attr("dy", "0.8em")
    .text("Total");

  Object.values(data).forEach((player, i) => {
    linesContainer.selectAll(`.line-group-${i+1}`)
      .data([player])
      .enter()
      .append("g")
      .attr("class", `line-group line-group-${i+1}`)
      .append("path")
      .datum(player)
      .attr("class", "line")
      .attr("fill", "none")
      .attr("stroke", color(i+1))
      .attr("d", line);

    linesContainer.selectAll(`.dot-group-${i+1}`)
      .data([player])
      .enter()
      .append("g")
      .attr("class", `dot-group dot-group-${i+1}`)
      .selectAll(`.dot-container-${i+1}`)
      .data(player)
      .enter()
      .append("g")
      .attr("class", `dot-container dot-container-${i+1}`)
      .on("mouseover", function (d) {
        d3.select(this)
          .style("cursor", "pointer")
          .append("text")
          .attr("class", "text")
          .text(`${d.total}`)
          .attr('text-anchor', 'middle')
          .attr("x", d => xScale(d.game))
          .attr("y", d => yScale(d.total)-15);
      })
      .on("mouseout", function (d) {
        d3.select(this)
          .style("cursor", "none")
          .selectAll(".text").remove();
      })
      .append("circle")
      .attr("class", `dot dot-${i+1}`)
      .attr("stroke", color(i+1))
      .attr("fill", "white")
      .attr("cx", function (d) { return xScale(d.game); })
      .attr("cy", function (d) { return yScale(d.total); })
      .attr("r", ".25%");
  });
}

module.exports = {
  makeGraph
};